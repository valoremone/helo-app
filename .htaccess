RewriteEngine On

# Redirect direct access to helo-apps directory
RewriteCond %{REQUEST_URI} ^/helo-apps/
RewriteRule ^helo-apps/admin/(.*)$ /admin/$1 [R=301,L]
RewriteRule ^helo-apps/member/(.*)$ /member/$1 [R=301,L]
RewriteRule ^helo-apps/public/(.*)$ /public/$1 [R=301,L]

# Allow access to static files
<FilesMatch "\.(html|css|js|jpg|jpeg|png|gif|ico|svg|woff|woff2|ttf|eot)$">
    Order Allow,Deny
    Allow from all
</FilesMatch>

# Handle landing page at root
RewriteCond %{REQUEST_URI} ^/$
RewriteRule ^$ landing/out/index.html [L]

# Handle landing page static files
RewriteCond %{REQUEST_URI} ^/(_next|images)/
RewriteRule ^(.*)$ landing/out/$1 [L]

# Handle admin portal
# First handle the assets
RewriteCond %{REQUEST_URI} ^/admin/assets/
RewriteRule ^admin/assets/(.*)$ admin/dist/assets/$1 [L]

# Then handle the root admin path
RewriteCond %{REQUEST_URI} ^/admin/?$
RewriteRule ^admin/?$ admin/dist/index.html [L]

# Finally handle all other admin paths for SPA routing
RewriteCond %{REQUEST_URI} ^/admin/
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^admin/(.*)$ admin/dist/index.html [L]

# Handle member portal
RewriteCond %{REQUEST_URI} ^/member
RewriteRule ^member/(.*)$ helo-apps/member/$1 [L]

# Handle public website
RewriteCond %{REQUEST_URI} ^/public
RewriteRule ^public/(.*)$ helo-apps/public/$1 [L]

# Prevent directory listing
Options -Indexes

# Enable CORS
Header set Access-Control-Allow-Origin "*"
Header set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
Header set Access-Control-Allow-Headers "Content-Type, Authorization"

# Handle OPTIONS method
RewriteCond %{REQUEST_METHOD} OPTIONS
RewriteRule ^(.*)$ $1 [R=200,L]

# Security headers
Header set X-Content-Type-Options "nosniff"
Header set X-Frame-Options "SAMEORIGIN"
Header set X-XSS-Protection "1; mode=block"
Header set Referrer-Policy "strict-origin-when-cross-origin"

# Allow access to .htaccess
<Files .htaccess>
    Order Allow,Deny
    Allow from all
</Files>

# Set default file permissions
<Files *>
    Order Allow,Deny
    Allow from all
</Files> 